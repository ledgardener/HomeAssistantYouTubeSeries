// Copy and paste the code below to import the flow to Node Red:

[{"id":"4c00655e.4cd224","type":"tab","label":"Humidifier Control","disabled":false,"info":""},{"id":"53ee927a.9a1434","type":"api-call-service","z":"4c00655e.4cd224","name":"","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.tplink1","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1150,"y":100,"wires":[[]]},{"id":"798972f9.e58d44","type":"api-call-service","z":"4c00655e.4cd224","name":"","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.tplink1","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1150,"y":160,"wires":[[]]},{"id":"d369ec2b.f240d8","type":"function","z":"4c00655e.4cd224","name":"","func":"var humisensor = msg.payload[\"sensor.ruuvi_humidity_4x4\"];\nvar humitarget = msg.payload[\"input_number.humidity_target\"];\nvar humitol = msg.payload[\"input_number.humidity_tolerance\"];\nvar humion = (humitarget - humitol);\nvar humioff = (humitarget + humitol);\n\nmsg.data.humi = {\"humidifier_on\":humion, \"humidifier_off\":humion};\n\nif (humidity < humion) {\n    var msg1={on};\n}\n\nelse if (humisensor > humioff) {\n    var msg2={off};\n}\nvar msg3={};\nmsg3.payload = msg.data.humi;\nreturn [msg1, msg2, msg3]","outputs":3,"noerr":0,"initialize":"","finalize":"","x":700,"y":140,"wires":[["5c9e479e.918e9"],["e1a78bd6.7f497"],["fb79822c.8a379","917f15b9.f587b8"]]},{"id":"5c9e479e.918e9","type":"api-current-state","z":"4c00655e.4cd224","name":"","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.tplink1","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":920,"y":100,"wires":[["53ee927a.9a1434"],[]]},{"id":"e1a78bd6.7f497","type":"api-current-state","z":"4c00655e.4cd224","name":"","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"switch.tplink1","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":920,"y":160,"wires":[["798972f9.e58d44"],[]]},{"id":"7f3d8042.3d10a8","type":"debug","z":"4c00655e.4cd224","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":590,"y":360,"wires":[]},{"id":"9df42140.57b78","type":"server-state-changed","z":"4c00655e.4cd224","name":"","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.humidity_target","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":220,"y":80,"wires":[["d7b1ed4.41dcb9"]]},{"id":"4a2385a4.b1bad4","type":"server-state-changed","z":"4c00655e.4cd224","name":"","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.humidity_tolerance","entityidfiltertype":"exact","outputinitially":true,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":230,"y":140,"wires":[["d7b1ed4.41dcb9"]]},{"id":"c9aef9a5.51ad18","type":"server-state-changed","z":"4c00655e.4cd224","name":"","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.ruuvi_humidity_4x4","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":200,"y":200,"wires":[["d7b1ed4.41dcb9"]]},{"id":"d7b1ed4.41dcb9","type":"join","z":"4c00655e.4cd224","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"3","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":530,"y":140,"wires":[["7f3d8042.3d10a8","d369ec2b.f240d8"]]},{"id":"fb79822c.8a379","type":"api-call-service","z":"4c00655e.4cd224","name":"Humidifier on pct","server":"fc1437ec.ba4bd8","version":1,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.humidifier_on","data":"{\"value\":\"{{humidifier_on}}\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":890,"y":220,"wires":[[]]},{"id":"917f15b9.f587b8","type":"api-call-service","z":"4c00655e.4cd224","name":"Humidifier off pct","server":"fc1437ec.ba4bd8","version":1,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.humidifier_off","data":"{\"value\":\"{{payload.humidifier_off}}\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":890,"y":280,"wires":[[]]},{"id":"fc1437ec.ba4bd8","type":"server","name":"Home Assistant","addon":true}]
